syntax = "proto3";

option csharp_namespace = "HslGateway.Grpc";

package hslgateway;

import "google/protobuf/wrappers.proto";

service Gateway {
  rpc GetTagValue (TagRequest) returns (TagResponse);
  rpc WriteTagValue (WriteTagRequest) returns (WriteTagResponse);
  rpc SubscribeTagValue (TagRequest) returns (stream TagResponse);
  rpc SubscribeDeviceStatus (DeviceRequest) returns (stream DeviceStatusResponse);
  rpc ListDevices (Empty) returns (DeviceList);
  rpc ListDeviceTags (DeviceRequest) returns (TagList);
}

service ConfigManager {
  rpc ListDevicesConfig (Empty) returns (DeviceConfigList);
  rpc UpsertDevice (DeviceConfigDto) returns (OperationStatus);
  rpc DeleteDevice (DeviceRequest) returns (OperationStatus);
  rpc ListTagConfigs (DeviceRequest) returns (TagConfigList);
  rpc UpsertTag (TagConfigDto) returns (OperationStatus);
  rpc DeleteTag (TagIdentifier) returns (OperationStatus);
  rpc ActivateEnterprise (EnterpriseActivationRequest) returns (OperationStatus);
}

message Empty {}

message TagRequest {
  string deviceId = 1;
  string tagName = 2;
}

message WriteTagRequest {
  string deviceId = 1;
  string tagName = 2;
  double value = 3;
}

message WriteTagResponse {
  bool success = 1;
  string message = 2;
}

message DeviceStatusResponse {
  string deviceId = 1;
  bool isOnline = 2;
  string timestampUtc = 3;
}

message TagResponse {
  string deviceId = 1;
  string tagName = 2;
  double value = 3;
  string timestampUtc = 4;
  string quality = 5;
}

message DeviceRequest {
  string deviceId = 1;
}

message Device {
  string id = 1;
}

message DeviceList {
  repeated Device devices = 1;
}

message TagInfo {
  string deviceId = 1;
  string tagName = 2;
  string address = 3;
  string dataType = 4;
}

message TagList {
  repeated TagInfo tags = 1;
}

message DeviceConfigDto {
  string id = 1;
  string type = 2;
  string ip = 3;
  int32 port = 4;
  int32 pollIntervalMs = 5;
  google.protobuf.Int32Value rack = 6;
  google.protobuf.Int32Value slot = 7;
  string portName = 8;
  google.protobuf.Int32Value baudRate = 9;
  google.protobuf.Int32Value dataBits = 10;
  google.protobuf.Int32Value stopBits = 11;
  google.protobuf.Int32Value parity = 12;
  uint32 station = 13;
}

message DeviceConfigList {
  repeated DeviceConfigDto devices = 1;
}

message TagConfigDto {
  string deviceId = 1;
  string name = 2;
  string address = 3;
  string dataType = 4;
}

message TagConfigList {
  repeated TagConfigDto tags = 1;
}

message TagIdentifier {
  string deviceId = 1;
  string tagName = 2;
}

message OperationStatus {
  bool success = 1;
  string message = 2;
}

message EnterpriseActivationRequest {
  bytes certificateBytes = 1;
  string authorizationCode = 2;
  bool persistCertificate = 3;
}
